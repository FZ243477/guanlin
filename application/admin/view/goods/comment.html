<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>{:getSetting('system.title')} </title>

	<link href="home_url/css/bootstrap.min.css" rel="stylesheet">
	<link href="home_url/css/font-awesome.css-v=4.4.0.css" rel="stylesheet">
	<link href="home_url/css/plugins/iCheck/custom.css" rel="stylesheet">
	<link href="home_url/css/style.min.css" rel="stylesheet">

	<style>
		.content_myupload  {
			opacity: 0;
			display:none;
		}
		td {
			height: 80px;
		}
	</style>
</head>

{include file="base:base" /}
<body class="gray-bg">
<div class="wrapper wrapper-content animated fadeInRight">
	<div class="row">
		<div class="col-sm-12">
			<div class="ibox">
				<div class="tabs-container">

					<div class="tab-content">
						<div id="tab-1" class="tab-pane active">
							<div class="panel-body">

								<div class="ibox-content-del">

									<div class="row">
										<!-- <form method="get" action="{:url('Manage/admin/status')}"> -->
										<form method="get" action="" class="form-inline">



											<div class="input-group">
												<input type="text" name="keyword" placeholder="商品" class=" form-control" value="" style="width:130px">
												<span class="input-group-btn">
												<button type="submit" class="btn btn-sm btn-primary"> 搜索</button> </span>
											</div>
<!--											<a href="{:url('Content/contentAdd')}" class="btn btn-sm btn-primary">添加内容</a>-->
										</form>

									</div>

									<div class="table-responsive">
										<table class="table table-hover products_table">
											<colgroup>
												<col width="5%">
												<col width="10%">
												<col width="10%">
												<col width="10%">
												<col width="10%">
												<col width="10%">
												<col width="10%">
												<col width="10%">
												<col width="10%">

											</colgroup>
											<thead>
											<tr >
												<td></td>
												<td>ID</td>
												<td>订单编号</td>
												<td>商品</td>
												<td>评价者</td>
												<td>评分</td>
												<td>是否显示</td>
												<td>审核状态</td>
												<td>评价时间</td>
												<td>操作</td>
											</tr>
											</thead>
											<tbody>
											{foreach name="lists" item="vo"}
											<tr>
												<td>
													<input type="checkbox" class="i-checks checkbox" name="input" value="{$vo.id}">
												</td>
												<td>{$vo.id}</td>
												<td><a href="{:url('Order/detail',array('order_id'=>$vo['order_id']))}" >{$vo.order_no}</a></td>
												<td>
													<div class="table-item-img"><img src="{$vo['goods_logo']}" height="80"></div>
													<div class="table-item-info">
														<a href="{:url('Goods/goodsAdd',array('id'=>$vo['goods_id']))}" >{$vo.goods_name}</a>
													</div>
												</td>
												<td>
													{switch name="vo['is_virtual']"}
													{case value="0"}
													<a href="{:url('User/userDetail',array('id'=>$vo['user_id']))}">
														<div class="table-item-img" style='border:0;'><img src="{$vo['head_img']}" style='width: 60px;height: 60px;border-radius: 50%;'></div>
														<div class="table-item-info">
															昵称：{$vo.nickname}<br/>手机号：{$vo.telephone}
														</div>
													</a>
													{/case}
													{case value="1"}
													<div class="table-item-img" style='border:0;'><img src="{$vo['virtual_logo']}" style='width: 60px;height: 60px;border-radius: 50%;'></div>
													<div class="table-item-info">
														<a href="javascript:;">[虚拟用户]-{$vo.virtual_name}</a>
													</div>
													{/case}
													{/switch}
												</td>
												<td>
													<p>描述相符：{$vo.desc_star} 星</p>
													<!--														<p>商品质量：{$vo.quality_star} 星</p>-->
												</td>

												<td>
													{if condition="($vo.is_show eq 1)"}
													<p style="color: green;cursor: pointer;" onclick="J_ChangeStatus(this)" data-id="{$vo.id}" title="已显示" >√</p>
													{else/}
													<p style="color: red;cursor: pointer;" onclick="J_ChangeStatus(this)" data-id="{$vo.id}" title="已隐藏" >×</p>
													{/if}
												</td>

												<td>
													{switch name="vo.status"}
													{case value="0"}<p>待审核</p>{/case}
													{case value="1"}<p style="color: green">审核通过</p>{/case}
													{case value="2"}<p style="color: red">审核未通过</p>{/case}
													{/switch}
												</td>
												<td>{$vo.add_time}</td>
												<td>
													<a href="{:url('Goods/commentDetail',array('id'=>$vo['id']))}" class='btn btn-primary'><i class="fa fa-plus"></i>详情</a>
													<a href="javascript:void(0)"data-id="{$vo.id}"  class='btn btn-default btn-sm btn_del'>删除</a>
												</td>
											</tr>
											{/foreach}
											{empty name="lists"}
											<tr><td style='text-align:center' colspan='8'>暂无数据</td></tr>
											{/empty}
											<tr>
												<td colspan="12" class="pro_lasttd">
													<label ><input type="checkbox" class="i-checks all"  name="inputs"><span>全选</span></label>
													<div class="pro_table_contro">
														<a href="javascript:void(0);" class="btn btn-default btn-sm btn_del"  data-id="">删除</a>

													</div>
												</td>
											</tr>
											</tbody>
										</table>

										<div class="text-center">
											<div class="page">
												{$lists->render()}
											</div>
										</div>

									</div>

								</div>


							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

	</div>
</div>
<script src="home_url/js/jquery.min.js"></script>
<script src="home_url/js/bootstrap.min.js"></script>
<script src="home_url/js/plugins/peity/jquery.peity.min.js"></script>
<script src="home_url/js/content.min.js"></script>
<script src="home_url/js/plugins/iCheck/icheck.min.js"></script>
<script src="home_url/js/peity-demo.min.js"></script>
<script src="home_url/js/plugins/layer/laydate/laydate.js"></script>
<script type="text/javascript">
	function J_ChangeStatus(obj) {
		var post = {};
		post.ids = $(obj).attr("data-id");
		dialog.showTips("确定要进行操作吗?", "firm", function () {
			$.post("{:url('Goods/changeCommentStatus')}", post, function (result) {
				if (result.status == 1) {
					dialog.showTips(result.msg, "", "1");
					return false;
				}
				dialog.showTips(result.msg,'warn');
				return false;
			}, "json")
		})
	}

	$('td.pro_lasttd input').on('ifChecked', function(event){
		$('input').iCheck('check');
	});
	$('td.pro_lasttd input').on('ifUnchecked', function(event){
		$('input').iCheck('uncheck');
	});
	$('.btn_change').click(function () {
		var id = $(this).attr('data-id');
		if(!id){
			$(".checkbox").each(function(){
				console.log($(this).val());
				if(true == $(this).is(':checked')){
					id += id?"-"+$(this).val():$(this).val();
				}
			});

			if(!id){
				alert('请选择数据');
				return false;
			}
		}
		var cate_id = $('#cate_id').val();
		dialog.showTips('确定转移吗？', "firm", function(){

			$.ajax({
				url: "{:url('Content/contentChange')}",
				type: "post",
				dataType: "json",
				data: {
					id: id,
					cate_id: cate_id,
				}
			}).done(function (res) {
				if (res.status == 1) {
					dialog.showTips(res.msg,"", 1);
				} else {
					alert(res.msg);
				}

			})
		})
	});
	$('.btn_del').click(function () {
		var id = $(this).attr('data-id');
		if(!id){
			$(".checkbox").each(function(){
				if(true == $(this).is(':checked')){
					id += id?"-"+$(this).val():$(this).val();
				}
			});

			if(!id){
				alert('请选择要删除的数据');
				return false;
			}
		}
		dialog.showTips('确定要删除吗？', "firm", function(){

			$.ajax({
				url: "{:url('Goods/delComment')}",
				type: "post",
				dataType: "json",
				data: {
					id: id,
				}
			}).done(function (res) {
				if (res.status == 1) {
					dialog.showTips(res.msg,"", 1);
				} else {
					alert(res.msg);
				}

			})
		})
	});


	//上下移
	$(".updown").click(function() {
		var id = $(this).attr("data-id");
		var post = {id: id};
		var keyword = $.trim($('input[name="keyword"]').val());
		var cate_id = $.trim($('select[name="cate_id"]').val());
		post.num = $(this).attr("data-num");
		post.search = {};
		if (keyword != '') {
			post.search['title'] = keyword;
			post.search['cate_id|class_id'] = cate_id;
		}

		$.ajax({
			url: "home_host/Content/upDown",
			type: "post",
			dataType: "json",
			data: post,
		}).done(function (res) {
			if (res.status == 1) {
				window.location.reload();
				// dialog.showTips(res.msg, "", 1);
			} else {
				alert(res.msg);
			}
		})
	});

	function status(id, item, obj){
		var $_this = $(obj);
		$.ajax({
			url: "{:url('Content/contentStatus')}",
			type: "post",
			dataType: "json",
			data: {id:id,item:item},
		}).done(function (data) {
			if (data.data[item] == 1) {
				$_this.css('color', '#0C0');
				$_this.html('√');
			} else {
				$_this.css('color', '#c00');
				$_this.html('×');
			}
		})

	}
</script>
<script>
	var start = {
		elem: "#start",
		format: "YYYY-MM-DD",
		max: laydate.now(),
		min: "2000-01-01",
		istime: true,
		istoday: false,
		choose: function (datas) {
			end.min = datas;
			end.start = datas
		}
	};
	var end = {
		elem: "#end",
		format: "YYYY-MM-DD",
		max: laydate.now(),
		min: "2000-01-01",
		istime: true,
		istoday: false,
		choose: function (datas) {
			start.min = datas
		}
	};
	laydate(start);
	laydate(end);



</script>
<script>
	$(document).ready(function () {
		$(".checkbox").on('click', function (event) {
			var i = 1;
			$(".checkbox").each(function(){
				if(true != $(this).is(':checked')){
					i = 0;
				}
			});
			if (i == 1) {
				$('td.pro_lasttd input').prop('checked', true);
			} else {
				$('td.pro_lasttd input').prop('checked', false);
			}
		});
		$('td.pro_lasttd input').on('click', function(event){
			if(true == $(this).is(':checked')){
				$('.checkbox').prop('checked', true);
			} else {
				$('.checkbox').prop('checked', false);
			}
		});
	});

	$("li").click(function(){
		$a=$(this).find("a").attr("href");
		// alert($a);
		if ($a) { window.location=$a; }
	})
</script>

</body>

</html>
