<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>{:getSetting('system.title')} </title>

	<link href="home_url/css/bootstrap.min.css" rel="stylesheet">
	<link href="home_url/css/font-awesome.css-v=4.4.0.css" rel="stylesheet">
	<link href="home_url/css/plugins/iCheck/custom.css" rel="stylesheet">
	<link href="home_url/css/style.min.css" rel="stylesheet">
	<link href="home_url/css/common.css" rel="stylesheet">
	<style>
		[v-cloak] {
			display: none;
		}
		.ibox-content-del .row_div {
			margin-top: 10px;
		}
		.txt_info {
			line-height: 30px;
			font-weight: bold;
		}
	</style>
</head>

{include file="base:base" /}
<body class="gray-bg">
<div id="app" v-cloak>
	<div class="wrapper wrapper-content animated fadeInRight">
		<div class="row">
			<div class="col-sm-12">
				<div class="ibox">
					<div class="tabs-container">

						<ul class="nav nav-tabs">
							<li :class="status == 0? 'active tabs_a fl':'tabs_a fl'" @click="btn_goods(0)">
								<a href="javascript:void(0);" class="active tabs_a fl">全部商品({{pageInfo.count0}})</a>
							</li>
							<li :class="status == 1? 'active tabs_a fl':'tabs_a fl'" @click="btn_goods(1)">
								<a href="javascript:void(0);" class=" tabs_a fl">出售中({{pageInfo.count1}})</a>
							</li>
							<li :class="status == 2? 'active tabs_a fl':'tabs_a fl'" @click="btn_goods(2)">
								<a href="javascript:void(0);" class=" tabs_a fl">已售罄({{pageInfo.count2}})</a>
							</li>
							<li :class="status == 3? 'active tabs_a fl':'tabs_a fl'" @click="btn_goods(3)">
								<a href="javascript:void(0);" class=" tabs_a fl">仓库中({{pageInfo.count3}})</a>
							</li>
							<li :class="status == 4? 'active tabs_a fl':'tabs_a fl'" @click="btn_goods(4)">
								<a href="javascript:void(0);" class=" tabs_a fl">回收站({{pageInfo.count4}})</a>
							</li>
						</ul>
						<div class="tab-content">
							<div id="tab-1" class="tab-pane active">
								<div class="panel-body">

									<div class="ibox-content-del">
										<div class="row row_div">
											<div class="tables-searchbox newcearchbox">
												<div class="col-sm-3">
													<div class="row">
														<div class="txt_info  col-sm-4">名称编码</div>
														<div class="col-sm-8"><input type="text" placeholder="商品名称|编码" class="input-sm form-control" name="keyword" value=""></div>
													</div>

												</div>
												<!--<div class="form_left">
                                                    <input type="text" placeholder="商品ID" class="input-sm form-control" name="id" value="">
                                                </div>-->
												<div class="col-sm-3">
													<div class="row">
														<div class="txt_info col-sm-4">品牌系列</div>
														<div class="col-sm-8">
															<select name='brand' class="input-sm form-control" @change="selectCoefficient" style='padding: 5px;'>
																<option value=''>选择品牌系列</option>
																<option  v-for="vo in goods_brand_new" :value='vo.id' v-html="vo.classname">{{vo.classname}}</option>

															</select>
														</div>
													</div>
												</div>
												<div class="col-sm-3">
													<div class="row">
														<div class="txt_info col-sm-4">分类</div>
														<div class="col-sm-8">
															<select name='cate' class="input-sm form-control" style='padding: 5px;'>
																<option value=''>选择分类</option>
																<option  v-for="vo in goods_cate_new" :value='vo.id' v-html="vo.classname">{{vo.classname}}</option>

															</select>
														</div>
													</div>
												</div>
												<div class="col-sm-3">
													<button class="btn btn-primary input-sm line_h10" @click="msgListView(1, 1)" style="line-height: 15px;"><i class="gicon-search white"></i>查询</button>
													<a href="{:url('Goods/goodsAdd')}" class="btn btn-primary input-sm line_h10" ><i class="gicon-search white"></i>添加商品</a>
												</div>
											</div>
										</div>
										<div class="table-responsive" >
											<table class="table table-hover products_table">
												<colgroup>
													<col width="1%">
													<col width="3%">
													<col width="5%">
													<col width="5%">
													<col width="5%">
													<col width="5%">
													<col width="5%">
													<col width="5%">
													<col width="5%">
													<col width="5%">
													<col width="5%">
													<col width="7%">
													<col width="7%">
													<col width="10%">
												</colgroup>
												<thead>

												<tr >
													<th></th>
													<th>ID</th>
													<th>商品图片</th>
													<th>商品品牌</th>
													<th>商品名称</th>
													<th>商品编码</th>
													<th>SKU名称</th>
													<th>SKU编码</th>
													<th>价格</th>
													<th>库存</th>
													<th>排序</th>
													<th>上架</th>
													<th>操作</th>
												</tr>
												</thead>
												<tbody>
												<template   v-for="(vo, key) in goodsList">
													<template v-if="vo.sku_info != ''"  >
														<tr  v-for="(item, index) in vo.sku_info">
															<td v-if="hasReset">
																<input type="checkbox" class="i-checks checkbox" v-if="checkedArr[vo['id']]['checked'] == 1" checked name="input" :value="vo.id" @click="selectOne(vo.id)">
																<input type="checkbox" class="i-checks checkbox" v-else  name="input" :value="vo.id" @click="selectOne(vo.id)">
															</td>
															<td class='center'>{{vo.id}}</td>
															<td class='center'><img :src="vo.goods_logo?vo.goods_logo:'home_url/images/zwtp.jpg'" width="50" height='50' style='border-radius: 50%;'></td>
															<td class='center'>{{vo.brand_name}}</td>
															<td class='center'>{{vo.goods_name}}</td>
															<td class='center'>{{vo.goods_code}}</td>
															<td class='center' >
																{{item.key_name}}
															</td>
															<td class='center'>
																{{item.bar_code}}
															</td>
															<td class='center'>{{item.price}}</td>
															<td class='center'>{{item.store_count}}</td>
															<td class='center'>{{vo.sort}}</td>
															<td class="center">
																<img width="20" height="20" :src="vo.is_sale==1?'home_url/images/yes.png':'home_url/images/cancel.png'" @click="status_info('is_sale', vo.id, key)"/>
															</td>
															<td class='center'>
																<a :href="'home_host/Goods/goodsAdd/id/'+vo.id" class="btn btn-primary upd"><i class="fa fa-plus"></i>&nbsp;编辑</a>
																<button type="button" class="btn btn-default btn-sm"  @click="delGoods(vo.id)">删除</button>
															</td>
														</tr>
													</template>
													<template v-else>
														<tr>
															<td v-if="hasReset">
																<input type="checkbox" class="i-checks checkbox" v-if="checkedArr[vo['id']]['checked'] == 1" checked name="input" :value="vo.id" @click="selectOne(vo.id)">
																<input type="checkbox" class="i-checks checkbox" v-else  name="input" :value="vo.id" @click="selectOne(vo.id)">
															</td>
															<td class='center'>{{vo.id}}</td>
															<td class='center'><img :src="vo.goods_logo?vo.goods_logo:'home_url/images/zwtp.jpg'" width="50" height='50' style='border-radius: 50%;'></td>
															<td class='center'>{{vo.brand_name}}</td>
															<td class='center'>{{vo.goods_name}}</td>
															<td class='center'>{{vo.goods_code}}</td>
															<td class='center' >

															</td>
															<td class='center'>

															</td>
															<td class='center'>{{vo.cost_price}}</td>
															<td class='center'>{{vo.b_coefficient}}</td>
															<td class='center'>{{vo.c_coefficient}}</td>
															<td class='center'>{{vo.oprice}}</td>
															<td class='center' v-if="priceReset && vo.is_show == 0">{{price[key]}}</td>
															<td class='center' v-else><input type="text" oninput="checkNum(this)" :value="vo.price" v-model="price[key]" @blur="priceEditOne(key)"></td>
															<td class='center'>{{vo.price}}</td>
															<td class='center'>{{vo.stores}}</td>
															<td class='center'>{{vo.sort}}</td>
															<td class="center">
																<img width="20" height="20" :src="vo.is_sale==1?'home_url/images/yes.png':'home_url/images/cancel.png'" @click="status_info('is_sale', vo.id, key)"/>
															</td>
															<td>
																<span v-if="vo.is_audit == 1">审核通过</span>
																<span v-if="vo.is_audit == 2">审核驳回</span>
																<span v-if="vo.is_audit == 0">待审核</span>
															</td>
															<td class='center'>
																<a :href="'/Goods/goodsDetail?id='+vo.id" class="btn btn-primary upd"><i class="fa fa-eye"></i>预览</a>
																<a :href="'home_host/Goods/goodsAdd/id/'+vo.id" class="btn btn-primary upd"><i class="fa fa-plus"></i>&nbsp;编辑</a>
																<button type="button" class="btn btn-primary" @click="priceBtnOne(key)">改价</button>
																<button type="button" class="btn btn-default btn-sm"  @click="delGoods(vo.id)">删除</button>
															</td>
														</tr>
													</template>
												</template>
												<tr v-if="goodsList == ''"><td style='text-align:center' colspan='18'>暂无数据</td></tr>
												<tr>
													<td colspan="12" class="pro_lasttd" v-if="hasReset">

														<input  @click="selectAll" type="checkbox" class="i-checks all" v-if="checkedAll == 1" checked name="inputs" >
														<input  @click="selectAll" type="checkbox" class="i-checks all" v-else name="inputs" >
														<span   @click="selectAll">全选</span>


														<div class="pro_table_contro">
															<a href="javascript:void(0);" class="btn btn-primary upd" @click="status_all('is_sale', 1)" >上架</a>
															<a href="javascript:void(0);" class="btn btn-primary upd" @click="status_all('is_sale', 0)" >下架</a>
															<a href="javascript:void(0);" class="btn btn-primary upd" @click="status_all('is_del', 1)" >回收站</a>
															<a href="javascript:void(0);" class="btn btn-primary upd" @click="status_all('is_del', 0)" >移除回收站</a>
															<a href="javascript:void(0);" class="btn btn-default btn-sm" @click="delGoods(0)" >删除</a>
														</div>

													</td>
												</tr>
												</tbody>
											</table>

											<div class="text-center">
												<div class="page" v-if="pageInfo.pageCount > 1">
													<navigation  v-if="hackReset" :pages="pageInfo.pageCount" :current="pageInfo.pageCurrent"  @navpage="msgListView"></navigation>
												</div>
											</div>

										</div>

									</div>


								</div>
							</div>
						</div>
					</div>
				</div>
			</div>

		</div>
		<div class="modal inmodal" id="myModal2" tabindex="-1" role="dialog" aria-hidden="true" style="margin-top:200px">
			<div class="modal-dialog">
				<div class="modal-content animated bounceInRight">
					<div class="modal-header" style="padding: 10px 15px;">
						<button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">关闭</span>
						</button>
						<h5 class="model_tit">商品审核</h5>
					</div>

					<div class="modal-body modal-prodot-body">

						<div class="model_body">
							<div class="model_address">

								<form class="form-horizontal">
									<div class="form-group clearfix">
										<label class="col-sm-2 control-label">审核状态</label>

										<div class="col-sm-9">
											<div class="row">
												<div class="col-sm-8">
													<input type="radio" name="audit_status" v-model="audit_status" checked value="1">同意
													<input type="radio" name="audit_status" v-model="audit_status" value="2">驳回
												</div>
											</div>
										</div>
									</div>

									<div class="form-group clearfix">
										<label class="col-sm-2 control-label">审核意见</label>
										<div class="col-sm-8">
											<textarea class="form-control" id="audit_msg" name="audit_msg" cols="100" rows="4" v-model="audit_msg"></textarea>
										</div>
									</div>
								</form>
							</div>
						</div>
					</div>

					<div class="modal-footer">
						<button type="button" class="btn btn-primary audit_submit" >确定</button>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<script src="home_url/js/jquery.min.js"></script>
<script src="home_url/js/bootstrap.min.js"></script>
<script src="home_url/js/plugins/peity/jquery.peity.min.js"></script>
<script src="home_url/js/content.min.js"></script>
<script src="home_url/js/plugins/iCheck/icheck.min.js"></script>
<script src="home_url/js/peity-demo.min.js"></script>
<script src="home_url/js/plugins/layer/laydate/laydate.js"></script>
<script src="home_url/js/plugins/layer/layer.min.js"></script>
<script type="text/javascript">

	$(document).ready(function () {



		$("._li_b1").click(function(){
			var edit=$(this).parent("._li_btn").siblings("._li_edit");
			$("._li_edit").not(edit).hide();
			edit.toggle();
		})

		function stopPropagation(e) {
			if (e.stopPropagation)
				e.stopPropagation();
			else
				e.cancelBubble = true;
		}
		$(document).bind('click',function(){
			$("._li_edit").hide();
		});

		$("._li_edit").bind('click',function(e){
			stopPropagation(e);
		});
		$("._li_b1").bind('click',function(e){
			stopPropagation(e);
		});


		$("li._li").click(function(){
			$(this).addClass("active").siblings("li._li").removeClass("active");
		})

		$("._tree_top a.pull-right").click(function(){
			$(".-add-box").toggle();
		})
		$(".-add-box .btn-default").click(function(){
			$(".-add-box").hide();
		})

	});

	$("li").click(function(){
		$a=$(this).find("a").attr("href");
		// alert($a);
		if ($a) { window.location=$a; }
	})
	function checkNum(obj) {
		// obj.value = obj.value.replace(/^0*/g, '');//第一个数不能为0 ，若为0替换为空
		obj.value = obj.value.replace(/[^\d]/g, "");//是否是数字 和小数点，若是除数字 和小数点之外的则替换为空
		// obj.value = obj.value.replace(/^\./g, "");//确证第一个为数字而不是“.”
		// obj.value = obj.value.replace(/\.{2,}/g, ".");//只能输入一个“.”
		// obj.value = obj.value.replace(".", "$#$").replace(/\./g, "").replace("$#$", ".");//保证”.“只出现一次，而不能出现两次以上
		// obj.value = obj.value.replace(/^(\-)*(\d+)\.(\d\d).*$/, '$1$2.$3');//只能输入两个小数   
	}
	function checkNums(obj) {
		// obj.value = obj.value.replace(/^0*/g, '');//第一个数不能为0 ，若为0替换为空
		obj.value = obj.value.replace(/[^\d.]/g, "");//是否是数字 和小数点，若是除数字 和小数点之外的则替换为空
		obj.value = obj.value.replace(/^\./g, "");//确证第一个为数字而不是“.”
		obj.value = obj.value.replace(/\.{2,}/g, ".");//只能输入一个“.”
		obj.value = obj.value.replace(".", "$#$").replace(/\./g, "").replace("$#$", ".");//保证”.“只出现一次，而不能出现两次以上
		obj.value = obj.value.replace(/^(\-)*(\d+)\.(\d\d\d).*$/, '$1$2.$3');//只能输入两个小数   
	}
</script>

<script src="home_url/js/vue/vue.min.js"></script>
<script src="home_url/js/vue/pagination.js"></script>
<script>
	var Url = window.location.protocol + '//' + window.location.host + '/admin';

	var app = new Vue({
		el: '#app',
		data: {
			goodsList: [],
			goods_cate_new: [],
			goods_brand_new: [],
			pageInfo: {
				pageCurrent: 1, // 当前页
				pageCount: 1, // 总页数
				list_row: 10, // 当前条数
				totalCount:0,
				count0:0,
				count1:0,
				count2:0,
				count3:0,
				count4:0,
				count5:0,
			},
			hackReset:true,
			is_button:0,
			status:0,
			audit:-1,
			is_cost_price:0,
			audit_status:1,
			audit_msg:'',
			goods_id:0,
			checkedAll:0,
			checkedArr:[],
			goods_coefficient:[],
			hasReset:true,
			pricedAll:0,
			priceReset:true,
			price:[],
		},
		created: function(){ //获得初始数据
			var $_this = this;
			var post = {
				type:1,
				list_row: $_this.pageInfo.list_row, //每页数据个数
				page: $_this.pageInfo.pageCurrent, // 当前页

			};
			$_this.ajaxFunction(post, 1);
			// $_this.msgListView($_this.list1P.pageNo)
			// $_this.msgListView1($_this.list2P.pageNo)

		},
		mounted: function(){
			// 如在这里开始渲染地图!!! initMap()
		},
		methods: {
			//商品列表
			ajaxFunction: function(post, type) {
				var $_this = this;
				$.ajax({
					type: "POST",
					url: Url + '/Goods/goodsList',
					data:post,
					dataType: 'json',
					success: function(data) {
						$_this.goodsList = data.data.list;
						$_this.goods_coefficient = data.data.goods_coefficient;
						var num = 0;
						var lenght = 0;
						$_this.goodsList.forEach(function (item, index) {
							if (!$_this.checkedArr[item.id] || $_this.checkedArr[item.id]['checked'] == 0) {
								$_this.checkedArr[item.id] = {'checked' : 0};
							} else if ($_this.checkedArr[item.id] && $_this.checkedArr[item.id]['checked'] == 1){
								num ++;
							}
							lenght ++;

							$_this.goodsList[index].is_show = 0;
							$_this.price[index] = item.p_price;
							if (item.sku_info != '') {
								item.sku_info.forEach(function (vo, k) {
									$_this.price[index+k] = vo.p_price;
									$_this.goodsList[index].sku_info[k].is_show = 0;
								});
							}
						});
						console.log($_this.checkedArr);

						$_this.is_cost_price = data.data.is_cost_price;
						$_this.goods_cate_new = data.data.goods_cate_new;
						$_this.goods_brand_new = data.data.goods_brand_new;
						$_this.pageInfo.pageCount = parseInt(data.data.pageCount) // 获取总页数
						if (type == 1) {
							$_this.pageInfo.count0 = parseInt(data.data.count0) //
							$_this.pageInfo.count1 = parseInt(data.data.count1) //
							$_this.pageInfo.count2 = parseInt(data.data.count2) //
							$_this.pageInfo.count3 = parseInt(data.data.count3) //
							$_this.pageInfo.count4 = parseInt(data.data.count4) //
							$_this.pageInfo.count5 = parseInt(data.data.count5) //
						}
						$_this.pricedAll = 0;
						$_this.hasReset = false;
						$_this.$nextTick(function () {
							if (num == lenght) {
								$_this.checkedAll = 1;
							} else {
								$_this.checkedAll = 0;
							}
							$_this.hasReset = true;
							//$_this.pageInfo.pageCurrent ++ ;
							/*$(".checkbox").on('click', function (event) {
								var i = 1;
								$(".checkbox").each(function(){
									if(true != $(this).is(':checked')){
										i = 0;
									}
								});
								if (i == 1) {
									$('td.pro_lasttd input').prop('checked', true);
								} else {
									$('td.pro_lasttd input').prop('checked', false);
								}
							});
							$('td.pro_lasttd input').on('click', function(event){
								if(true == $(this).is(':checked')){
									$('.checkbox').prop('checked', true);
								} else {
									$('.checkbox').prop('checked', false);
								}
							});*/
							/*$('td.pro_lasttd input').on('click', function(event){
								$('input').removeAttr('checked');
							});*/
							/*$(".j-audit").click(function(){
								$_this.goods_id = $(this).attr('data-id');
								console.log($_this.goods_id );
								$('#myModal2').show();
							});
							$(".close").click(function(){
								//id = $(this).attr("data-id");
								$('.inmodal').hide();
								//$('#albums-overlay').show();
							});
							$('.audit_submit').click(function () {
								let audit_msg = $('#audit_msg').val();
								let audit_status = $('input[name="audit_status"]:checked').val();
								let post = {
									audit_status:audit_status,
									audit_msg:audit_msg,
									goods_id:$_this.goods_id,
								};
								$.ajax({
									type:"POST",
									url: Url + '/Goods/goodsAudit',
									data: post,
									dataType:"json",
									success:function(g){
										if (g.status == 1) {
											$_this.msgListView(1, 0);
											alert(g.msg);
											$('.inmodal').hide();
										} else {
											alert(g.msg);
										}
									}
								})
							})*/
						})
					}
				})
			},
			//分页
			msgListView: function(pageCurrent, is_button){ //搜索分页数据
				var $_this = this;
				var post = {
					type:1,
					list_row: $_this.pageInfo.list_row, //每页数据个数
					page: pageCurrent, // 当前页
					status:$_this.status,
					audit:$_this.audit,
				};

				if (is_button == 1) {
					$_this.is_button = is_button;
				}
				if ($_this.is_button == 1) {
					post.id = $('input[name="id"]').val();
					post.keyword = $('input[name="keyword"]').val();
					post.cate = $('select[name="cate"]').val();
					post.brand = $('select[name="brand"]').val();
				}
				$_this.ajaxFunction(post, 0);
			},
			//搜索
			btn_goods: function(status) {
				var $_this = this;
				$_this.status = status;
				var post = {status:status};
				post.audit = $_this.audit;
				post.type = 1;
				$('input[name="id"]').val('');
				$('input[name="keyword"]').val('');
				$('select[name="cate"]').val('');
				$('select[name="brand"]').val('');
				post.id = $('input[name="id"]').val();
				post.keyword = $('input[name="keyword"]').val();
				post.cate = $('select[name="cate"]').val();
				post.brand = $('select[name="brand"]').val();
				$_this.ajaxFunction(post, 0);
			},
			//导出
			exportGoods: function() {
				if (this.goodsList == '') {
					alert('暂无数据');
					return false;
				}
				var status = this.status;
				var audit = this.audit;
				var url = "{:url('Goods/goodsExport')}?status="+status+"&audit="+audit+"&type=1";
				var id = $('input[name="id"]').val();
				var keyword = $('input[name="keyword"]').val();
				var cate = $('select[name="cate"]').val();
				var brand = $('select[name="brand"]').val();
				if (id) {
					url += '&id='+id;
				}
				if (keyword) {
					url += '&keyword='+keyword;
				}
				if (cate) {
					url += '&cate='+cate;
				}
				if (brand) {
					url += '&brand='+brand;
				}
				window.location.href = url;
			},
			//审核
			btn_audit: function(audit) {
				var $_this = this;
				$_this.audit = audit;
				var post = {audit:audit};
				post.type = 1;
				post.status = $_this.status;
				$('input[name="id"]').val('');
				$('input[name="keyword"]').val('');
				$('select[name="cate"]').val('');
				$('select[name="brand"]').val('');
				post.id = $('input[name="id"]').val();
				post.keyword = $('input[name="keyword"]').val();
				post.cate = $('select[name="cate"]').val();
				post.brand = $('select[name="brand"]').val();
				$_this.ajaxFunction(post, 1);
			},
			//删除
			delGoods: function (id) { //删除用户
				var $_this = this;
				$_this.checkedArr.forEach(function (item, index) {
					if (item.checked == 1) {
						id += id?"-"+index:index;
					}
				});
				dialog.showTips('确定要删除吗？', "firm", function(){

					$.ajax({
						type: "POST",
						url: Url + '/Goods/delGoods',
						data: {
							id: id,
						},
						dataType: "json",
						success: function (res) {
							if (res.status == 1) {
								$_this.$nextTick(function() {
									$_this.msgListView($_this.pageInfo.pageCurrent,1)
									//window.location.reload();
								})
							} else {
								alert(res.msg);
							}
						}
					});
				})
			},
			//修改单个状态
			status_info: function (item, id, key) {

				var $_this = this;
				$.ajax({
					type:"POST",
					url: Url + '/Goods/goodsStatus',
					data: {id:id, item:item, val:0, type:0},
					dataType:"json",
					success:function(data){
						if (data.status == 0) {
							alert(data.msg);
						} else {
							$_this.goodsList[key][item] = data.data[item];
							$_this.$nextTick(function () {

							})
						}
					}
				})
			},
			//批量修改状态
			status_all: function (item, val) {
				var type = item+val
				switch (type) {
					case 'is_sale1':
						var text='上架'
						break;
					case 'is_sale0':
						var text='下架'
						break;
					case 'is_del1':
						var text='添加回收站'
						break;
					case 'is_del0':
						var text='移除回收站'
						break;
				}
				var id = '';
				this.checkedArr.forEach(function (item, index) {
					if (item.checked == 1) {
						id += id?"-"+index:index;
					}
				});
				if(!id){
					alert('请选择数据');
					return false;
				}
				var $_this = this;
				$.ajax({
					type:"POST",
					url: Url + '/Goods/goodsStatus',
					data: {id:id, item:item, val:val, type:1},
					dataType:"json",
					success:function(data){
						/*$_this.goodsList.forEach((v, index) => {
									$_this.goodsList[index][item] = val;
								}

						);*/
						if (data.status == 0) {
							alert(data.msg);
						} else {
							//$_this.goodsList[key][item] = data.data[item];
							$_this.$nextTick(function(){
								$_this.msgListView($_this.pageInfo.pageCurrent,1)
								//window.location.reload();
							})
						}
					}
				})
			},
			//单选
			selectOne: function (id) {
				var $_this = this;
				var checked = $_this.checkedArr[id]['checked'];
				$_this.hasReset = false;
				$_this.$nextTick(function () {
					$_this.checkedArr[id]['checked'] = 1-checked;
					var num = 0;
					var lenght = 0;
					$_this.goodsList.forEach(function (item) {
						if ($_this.checkedArr[item.id] && $_this.checkedArr[item.id]['checked'] == 1){
							num ++;
						}
						lenght ++;
					});
					$_this.$nextTick(function () {
						if (num == lenght) {
							$_this.checkedAll = 1
						} else {
							$_this.checkedAll = 0;
						}
					});
					$_this.hasReset = true;
				});
				console.log($_this.checkedArr);
			},
			//全选
			selectAll: function () {
				var $_this = this;
				$_this.checkedAll = 1-$_this.checkedAll;

				$_this.goodsList.forEach(function (item) {
					$_this.checkedArr[item.id]['checked'] = $_this.checkedAll;
				});
				console.log($_this.checkedArr);
			},
			//选择品牌获得商品系数
			selectCoefficient: function() {
				var $_this = this;
				var brand_id = $('select[name="brand"]').val();

				$.ajax({
					type:"POST",
					url: Url + '/Goods/getGoodsCoefficient',
					data: {brand_id:brand_id},
					dataType:"json",
					success:function(data){
						$_this.goods_coefficient = data.data.goods_coefficient;
					}
				});
			},
			//保存系数修改价格
			saveCoefficient: function () {
				var $_this = this;
				console.log($_this.goods_coefficient);
				var brand_id = $('select[name="brand"]').val();
				if (brand_id == 0) {
					alert('请选择品牌');
					return false;
				}
				if ($_this.goods_coefficient['b_coefficient'] <= 0) {
					alert('B端供货价系数必须大于0');
					return false;
				}
				if ($_this.goods_coefficient['c_coefficient'] <= 0) {
					alert('C端零售价系数必须大于0');
					return false;
				}
				$_this.goods_coefficient['brand_id'] = brand_id;
				$.ajax({
					type:"POST",
					url: Url + '/Goods/setGoodsCoefficient',
					data: $_this.goods_coefficient,
					dataType:"json",
					success:function(data){
						alert(data.msg);
						var post = {
							type:1,
							list_row: $_this.pageInfo.list_row, //每页数据个数
							page: $_this.pageInfo.pageCurrent, // 当前页
							status:$_this.status,
							audit:$_this.audit,
						};
						post.id = $('input[name="id"]').val();
						post.keyword = $('input[name="keyword"]').val();
						post.cate = $('select[name="cate"]').val();
						post.brand = $('select[name="brand"]').val();
						$_this.ajaxFunction(post, 1);
					}
				});
			},
			//改价按钮 商品
			priceBtnOne: function (key) {
				var $_this = this;
				$_this.priceReset = false;
				$_this.$nextTick(function () {
					$_this.goodsList[key].is_show = 1 - $_this.goodsList[key].is_show;
					$_this.priceReset = true;
				});
			},
			//改价按钮 规格
			priceBtnTwo: function (key, index) {
				var $_this = this;
				$_this.priceReset = false;
				$_this.$nextTick(function () {
					$_this.goodsList[key].sku_info[index].is_show = 1 - $_this.goodsList[key].sku_info[index].is_show;
					$_this.priceReset = true;
				});
			},
			//改价按钮 批量
			priceBtnAll: function () {
				var $_this = this;
				$_this.pricedAll = 1-$_this.pricedAll;
				$_this.priceReset = false;
				$_this.$nextTick(function () {
					$_this.goodsList.forEach(function (item, index) {
						$_this.goodsList[index].is_show = $_this.pricedAll;
						if (item.sku_info != '') {
							item.sku_info.forEach(function (vo, k) {
								$_this.goodsList[index].sku_info[k].is_show = $_this.pricedAll;
							});
						}
					});
					$_this.priceReset = true;
				});
			},
			//修改价格
			priceEditOne: function (key) {
				var $_this = this;
				var goods_id = $_this.goodsList[key].id;
				var price = $_this.price[key];
				$.ajax({
					type:"POST",
					url: Url + '/Goods/priceEdit',
					data: {goods_id:goods_id,sku_id:0,price:price},
					dataType:"json",
					success:function(data){
						$_this.priceReset = false;
						$_this.$nextTick(function () {
							if (data.status == 0) {
								$_this.price[key] = $_this.goodsList[key].price;
								alert(data.msg);
							}
							$_this.priceReset = true;
						});
					}
				});
			},
			priceEditTwo: function (key, index) {
				var $_this = this;
				var goods_id = $_this.goodsList[key].id;
				var sku_id = $_this.goodsList[key].sku_info[index].key;
				var price = $_this.price[key];
				$.ajax({
					type:"POST",
					url: Url + '/Goods/priceEdit',
					data: {goods_id:goods_id,sku_id:sku_id,price:price},
					dataType:"json",
					success:function(data){
						$_this.priceReset = false;
						$_this.$nextTick(function () {
							if (data.status == 0) {
								$_this.price[key] = $_this.goodsList[key].sku_info[index].price;
								alert(data.msg);
							}
							$_this.priceReset = true;
						});
					}
				});
			}
		}
	})
	function call_back(data) {
		if (data.status == 1) {
			alert('发送成功');
			layer.closeAll('iframe');
		} else {
			alert('发送失败');
		}

	}

</script>
</body>

</html>
